<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hand AR Minecraft Builder</title>
<style>
body{margin:0;overflow:hidden;background:black;}
video{display:none;}
</style>
</head>
<body>

<video id="video" autoplay playsinline></video>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
/* CAMERA */
navigator.mediaDevices.getUserMedia({
 video:{facingMode:"environment"}
}).then(s=>video.srcObject=s);

const video=document.getElementById("video");

/* THREE JS */
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
camera.position.z=8;

const renderer=new THREE.WebGLRenderer({alpha:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,0.8));
const light=new THREE.DirectionalLight(0xffffff,1);
light.position.set(1,1,1);
scene.add(light);

/* BLOCK MATERIAL */
const mat=new THREE.MeshStandardMaterial({color:0x00ff00});

/* BLOCK STACK DATA */
let stacks={}; // key = x_z , value = height

function placeBlock(x,z){
 const key=`${x}_${z}`;
 const y=stacks[key] ? stacks[key] : 0;

 const block=new THREE.Mesh(
  new THREE.BoxGeometry(0.8,0.8,0.8),
  mat
 );
 block.position.set(x,y,z);
 scene.add(block);

 stacks[key]=y+0.8;
}

/* HAND TRACKING */
const hands=new Hands({
 locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
});
hands.setOptions({
 maxNumHands:1,
 minDetectionConfidence:0.7,
 minTrackingConfidence:0.7
});

let lastPlace=0;

hands.onResults(res=>{
 if(!res.multiHandLandmarks) return;

 const lm=res.multiHandLandmarks[0];
 const index=lm[8];
 const thumb=lm[4];

 const pinch=Math.hypot(
  index.x-thumb.x,
  index.y-thumb.y
 )<0.05;

 const x=Math.round((index.x-0.5)*6);
 const z=Math.round((index.y-0.5)*6);

 if(pinch && Date.now()-lastPlace>600){
  placeBlock(x,z);
  lastPlace=Date.now();
 }
});

/* START CAMERA */
const cam=new Camera(video,{
 onFrame:async()=>hands.send({image:video}),
 width:640,height:480
});
cam.start();

function animate(){
 requestAnimationFrame(animate);
 renderer.render(scene,camera);
}
animate();
</script>

</body>
</html>
