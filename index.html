<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hand Minecraft AR</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<style>
body{margin:0;overflow:hidden;background:black;color:white;font-family:sans-serif}
#startBtn{
 position:absolute;
 top:50%;left:50%;
 transform:translate(-50%,-50%);
 padding:15px 30px;
 font-size:18px;
 background:#00ffcc;
 border:none;
 border-radius:10px;
}
</style>
</head>
<body>

<button id="startBtn">ALLOW CAMERA</button>
<video id="video" autoplay playsinline style="display:none"></video>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
const btn=document.getElementById("startBtn");
const video=document.getElementById("video");

let scene,camera,renderer,hands,cam;
let stacks={};
let lastPlace=0;

btn.onclick=async()=>{
 btn.style.display="none";

 // REQUEST CAMERA AFTER USER CLICK
 const stream=await navigator.mediaDevices.getUserMedia({
  video:{facingMode:{exact:"environment"}}
 });
 video.srcObject=stream;

 // THREE.JS
 scene=new THREE.Scene();
 camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
 camera.position.z=8;

 renderer=new THREE.WebGLRenderer({alpha:true});
 renderer.setSize(innerWidth,innerHeight);
 document.body.appendChild(renderer.domElement);

 scene.add(new THREE.AmbientLight(0xffffff,0.8));
 const light=new THREE.DirectionalLight(0xffffff,1);
 light.position.set(1,1,1);
 scene.add(light);

 const mat=new THREE.MeshStandardMaterial({color:0x00ff00});

 function placeBlock(x,z){
  const key=x+"_"+z;
  const y=stacks[key]||0;

  const block=new THREE.Mesh(
   new THREE.BoxGeometry(0.8,0.8,0.8),
   mat
  );
  block.position.set(x,y,z);
  scene.add(block);

  stacks[key]=y+0.8;
 }

 // HAND TRACKING
 hands=new Hands({
  locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
 });
 hands.setOptions({
  maxNumHands:1,
  minDetectionConfidence:0.7,
  minTrackingConfidence:0.7
 });

 hands.onResults(res=>{
  if(!res.multiHandLandmarks) return;

  const lm=res.multiHandLandmarks[0];
  const index=lm[8];
  const thumb=lm[4];

  const pinch=Math.hypot(
   index.x-thumb.x,
   index.y-thumb.y
  )<0.05;

  const x=Math.round((index.x-0.5)*6);
  const z=Math.round((index.y-0.5)*6);

  if(pinch && Date.now()-lastPlace>600){
   placeBlock(x,z);
   lastPlace=Date.now();
  }
 });

 cam=new Camera(video,{
  onFrame:async()=>hands.send({image:video}),
  width:640,
  height:480
 });
 cam.start();

 animate();
};

function animate(){
 requestAnimationFrame(animate);
 renderer.render(scene,camera);
}
</script>

</body>
</html>
